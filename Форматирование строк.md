#### Вся функциональность `stdio.h` для форматирования строк:**

**1. `sprintf()` — форматирование в строку**
```c
int sprintf(char *str, const char *format, ...);
```

```c
char buffer[100];
int x = 42;
float y = 3.14;

sprintf(buffer, "Число: %d, float: %.2f", x, y);
// buffer = "Число: 42, float: 3.14"

// Спецификаторы формата:
sprintf(buffer, "%d", x);        // Десятичное целое
sprintf(buffer, "%i", x);        // Десятичное целое (синоним %d)
sprintf(buffer, "%u", 42u);      // Беззнаковое целое
sprintf(buffer, "%o", 255);      // Восьмеричное: 377
sprintf(buffer, "%x", 255);      // Шестнадцатеричное (нижний регистр): ff
sprintf(buffer, "%X", 255);      // Шестнадцатеричное (верхний регистр): FF
sprintf(buffer, "%f", y);        // Десятичное с плавающей точкой
sprintf(buffer, "%e", y);        // Научная нотация: 3.140000e+00
sprintf(buffer, "%E", y);        // Научная нотация (E в верхнем регистре)
sprintf(buffer, "%g", y);        // Кратчайший из %f или %e
sprintf(buffer, "%G", y);        // Кратчайший из %f или %E
sprintf(buffer, "%c", 'A');      // Символ
sprintf(buffer, "%s", "hello");  // Строка
sprintf(buffer, "%p", &x);       // Указатель (адрес)
sprintf(buffer, "%%");           // Символ процента
```

**2. `snprintf()` — безопасное форматирование с ограничением длины**
```c
int snprintf(char *str, size_t size, const char *format, ...);
```

```c
char buffer[10];
int x = 12345;

// Автоматически обрезает чтобы не выйти за границы
int written = snprintf(buffer, sizeof(buffer), "Число: %d", x);
// buffer = "Число: 1" (обрезано!)
// written = сколько байт БЫЛО БЫ записано без ограничения

if (written >= sizeof(buffer)) {
    printf("Буфер слишком мал! Нужно %d байт\n", written + 1);
}
```

**3. Флаги форматирования**
```c
char buffer[50];

// Выравнивание и заполнение:
sprintf(buffer, "%10d", 42);      // "        42" (выравнивание вправо)
sprintf(buffer, "%-10d", 42);     // "42        " (выравнивание влево)
sprintf(buffer, "%+d", 42);       // "+42" (всегда показывать знак)
sprintf(buffer, "% d", 42);       // " 42" (пробел вместо + для положительных)
sprintf(buffer, "%#x", 255);      // "0xff" (префикс для hex/oct)
sprintf(buffer, "%#o", 8);        // "010" (префикс 0 для octal)
sprintf(buffer, "%05d", 42);      // "00042" (заполнение нулями)
sprintf(buffer, "%.*f", 3, 3.14159); // "3.142" (точность из аргумента)

// Ширина из аргумента:
sprintf(buffer, "%*d", 10, 42);   // "        42" (ширина = 10)
```

**4. Модификаторы типа**
```c
// Для целых чисел:
sprintf(buffer, "%hd", (short)42);    // short
sprintf(buffer, "%ld", 1000000L);     // long
sprintf(buffer, "%lld", 1000000000LL);// long long
sprintf(buffer, "%lu", 1000000UL);    // unsigned long

// Для чисел с плавающей точкой:
sprintf(buffer, "%Lf", 3.14L);        // long double

// Для указателей (разные компиляторы):
sprintf(buffer, "%zu", sizeof(int));  // size_t
sprintf(buffer, "%td", ptrdiff);      // ptrdiff_t
sprintf(buffer, "%jd", intmax_value); // intmax_t
```

**5. Возвращаемое значение**
```c
int x = 123;
char buf[50];

int count = sprintf(buf, "Число: %d", x);
// count = количество записанных символов (без '\0')
// В случае ошибки возвращает отрицательное число
```

**7. Примеры сложного форматирования**
```c
char buffer[100];

// Дата и время:
int year = 2024, month = 3, day = 15;
sprintf(buffer, "%04d-%02d-%02d", year, month, day); // "2024-03-15"

// Шестнадцатеричный дамп:
unsigned char data[] = {0xDE, 0xAD, 0xBE, 0xEF};
sprintf(buffer, "%02X %02X %02X %02X", 
        data[0], data[1], data[2], data[3]); // "DE AD BE EF"

// Финансовый формат:
float amount = 1234.567;
sprintf(buffer, "$%'.2f", amount);  // "$1,234.57" (апостроф для разделителя)

// Научный формат с точностью:
double value = 0.000123456;
sprintf(buffer, "%.3e", value); // "1.235e-04"

// Процент:
float percentage = 0.4567;
sprintf(buffer, "%.1f%%", percentage * 100); // "45.7%"
```

**7. Безопасное построение строки по частям**
```c
char buffer[100];
int pos = 0;

// Построчное добавление
pos += snprintf(buffer + pos, sizeof(buffer) - pos, "Часть 1: %d", 10);
pos += snprintf(buffer + pos, sizeof(buffer) - pos, ", Часть 2: %.2f", 3.14);
// buffer = "Часть 1: 10, Часть 2: 3.14"
```

**8. Полный список спецификаторов с примерами**
```c
// Целые числа:
%d / %i    // Десятичное целое со знаком
%u         // Десятичное целое без знака  
%o         // Восьмеричное без знака
%x / %X    // Шестнадцатеричное без знака (нижний/верхний регистр)

// Числа с плавающей точкой:
%f / %F    // Десятичная запись
%e / %E    // Научная нотация
%g / %G    // Автовыбор %f или %e
%a / %A    // Шестнадцатеричная запись (C99)

// Символы и строки:
%c         // Символ
%s         // Строка
%p         // Указатель

// Специальные:
%n         // Записывает количество выведенных символов
%%         // Символ процента
```

**9. Важные особенности**
```c
// 1. Не добавляет '\n' автоматически
sprintf(buffer, "Hello"); // buffer = "Hello" (без перевода строки)

// 2. Может переполнить буфер (используйте snprintf!)
char small[5];
sprintf(small, "Very long string"); // ПЕРЕПОЛНЕНИЕ!

// 3. Поддерживает локаль (зависит от локали системы)
setlocale(LC_NUMERIC, "de_DE");
sprintf(buffer, "%.2f", 1234.56); // "1234,56" (запятая вместо точки)

// 4. Аргументы преобразуются по стандартным правилам C
sprintf(buffer, "%d", 'A');  // 65 (char → int)
sprintf(buffer, "%f", 42);   // 0.000000 (int → double, но результат мусор!)
```

**10. Пример безопасной функции-обертки**
```c
#include <stdio.h>
#include <stdarg.h>

// Безопасное форматирование строки
int safe_format(char *buf, size_t size, const char *fmt, ...) {
    va_list args;
    va_start(args, fmt);
    int result = vsnprintf(buf, size, fmt, args);
    va_end(args);
    
    if (result < 0) {
        buf[0] = '\0';  // Ошибка форматирования
        return 0;
    }
    
    return result;
}

// Использование
char buffer[20];
safe_format(buffer, sizeof(buffer), "Value: %d", 42);
```



**Что НЕ умеют sprintf/snprintf:**

1. **Динамическое выделение памяти** — нужно заранее знать размер
    
2. **Конкатенация** — только через последовательные вызовы
    
3. **Регулярные выражения** — только простые шаблоны
    
4. **JSON/XML** — только ручное форматирование
    

**Короче:** `sprintf()` и `snprintf()` — это основные инструменты для форматирования строк в C. Они используют те же спецификаторы, что и `printf()`, но результат пишут в буфер вместо вывода на экран.